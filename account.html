<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Account â€” Mkart</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="site-header">
    <h1><a href="/">ğŸ›’ Mkart</a></h1>
    <div class="header-actions">
      <a href="/">ğŸ  Home</a>
      <a href="cart.html">ğŸ›’ Cart</a>
      <a href="admin.html">âš™ï¸ Admin</a>
    </div>
  </header>

  <main class="auth-container">
    <h2>Account</h2>
    
    <div id="authSection">
      <div class="auth-tabs">
        <button class="auth-tab active" data-form="signupForm">Sign Up</button>
        <button class="auth-tab" data-form="loginForm">Login</button>
      </div>

      <div id="signupForm" class="auth-form active">
        <h3>Create Account</h3>
        <div class="form-group">
          <label>Email</label>
          <input id="signupEmail" placeholder="your@email.com" type="email" />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input id="signupPassword" placeholder="Password (minimum 6 characters)" type="password" />
        </div>
        <button id="signupBtn" class="btn btn-primary" style="width: 100%; padding: 0.75rem;">Create Account</button>
      </div>

      <div id="loginForm" class="auth-form">
        <h3>Login</h3>
        <div class="form-group">
          <label>Email</label>
          <input id="loginEmail" placeholder="your@email.com" type="email" />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input id="loginPassword" placeholder="Password" type="password" />
        </div>
        <button id="loginBtn" class="btn btn-primary" style="width: 100%; padding: 0.75rem;">Login</button>
      </div>

      <div id="userInfo" style="display:none;">
        <div class="user-avatar">ğŸ‘¤</div>
        <h3>Welcome!</h3>
        <p>Signed in as <strong id="userEmail"></strong></p>
        <button id="logoutBtn" class="btn btn-danger" style="width: 100%; padding: 0.75rem; margin-top: 1rem;">Logout</button>
      </div>
    </div>

    <section id="ordersSection" class="orders-section">
      <h2>ğŸ“¦ Order History</h2>
      <div id="ordersList">Please login to view your orders.</div>
    </section>
  </main>

  <script src="js/products.js"></script>
  <script src="js/auth.js"></script>
</body>
</html>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Replace with your Firebase client config (from Firebase console)
    const firebaseConfig = {
      apiKey: "FIREBASE_API_KEY",
      authDomain: "PROJECT.firebaseapp.com",
      projectId: "PROJECT_ID",
      // other fields...
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const signupBtn = document.getElementById('signupBtn');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    signupBtn.addEventListener('click', async () => {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      try {
        const u = await auth.createUserWithEmailAndPassword(email, password);
        await db.collection('users').doc(u.user.uid).set({ email });
        alert('Account created!');
      } catch (e) { alert(e.message) }
    });

    loginBtn.addEventListener('click', async () => {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (e) { alert(e.message) }
    });

    logoutBtn.addEventListener('click', () => auth.signOut());

    auth.onAuthStateChanged(async user => {
      const authSection = document.getElementById('authSection');
      const userInfo = document.getElementById('userInfo');
      const userEmailEl = document.getElementById('userEmail');
      const ordersList = document.getElementById('ordersList');

      if (!user) {
        userInfo.style.display = 'none';
        authSection.querySelector('#authForms').style.display = 'flex';
        ordersList.innerHTML = 'Please login to view your orders.';
        return;
      }

      userInfo.style.display = '';
      authSection.querySelector('#authForms').style.display = 'none';
      userEmailEl.textContent = user.email;

      // Load order history (orders must be written to Firestore by webhook)
      const snap = await db.collection('orders').where('email','==', user.email).orderBy('createdAt','desc').get();
      if (snap.empty) {
        ordersList.innerHTML = '<p>No orders yet.</p>';
      } else {
        ordersList.innerHTML = '';
        snap.forEach(doc => {
          const o = doc.data();
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `<strong>Order</strong> â€” ${doc.id}<br>Email: ${o.email || ''}<br><pre style="white-space:pre-wrap">${JSON.stringify(o.snipcartOrder?.items || o.snipcartOrder, null, 2)}</pre>`;
          ordersList.appendChild(div);
        });
      }
    });
  </script>
</body>
</html>